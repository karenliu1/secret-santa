<html>
    <head>
        <title>Secret Santa!</title>
        <script src="https://cdn.firebase.com/js/client/2.3.1/firebase.js"></script>
        <script src="https://code.jquery.com/jquery-2.1.4.js"></script>
        <script type="text/javascript">
            var ref = new Firebase("https://scorching-inferno-8300.firebaseio.com/");

            function showUsersInRoom(roomName) {
                window.currentRoomName = roomName;
                $('#room-members').empty();
                var usersRef = ref.child(roomName).child('users')
                usersRef.on('child_added', function(usersResponse) {
                    var users = usersResponse.val()
                    $('#room-members-title').show();
                    $('#add-user-form').show();
                    $('#room-members').append('<p>' + users + '</p>');
                });
            }

            $(function() {
                $("#room-form").submit(function(event) {
                    var roomName = $('#room-input').val();
                    showUsersInRoom(roomName);
                    return false;
                });

                $('#add-user-form').submit(function(event) {
                    var usersRef = ref.child(window.currentRoomName).child('users');
                    var userName = $('#user-name-input').val();
                    usersRef.push(userName);
                    $('#add-user-form').hide();
                    return false;
                });

                // Hide room members and add user form until a room is chosen
                $('#room-members-title').hide();
                $('#add-user-form').hide();
            });
        </script>
    </head>
    <body>
        <form id="room-form">
            <label>
                What is the Secret Santa room name?
                <input type="text" id="room-input" value="">
            </label>
            <input type="submit" value="Go">
        </form>

        <div id="room-members-title">
            In this room so far:
        </div>
        <div id="room-members"></div>
        <form id="add-user-form">
            <label>
                Who are you?
                <input type="text" id="user-name-input" value="">
            </label>
            <input type="submit" value="Go">
        </form>

    </body>
</html>
